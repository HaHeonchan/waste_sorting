/**
 * GPT 프롬프트 템플릿 모음
 * 쓰레기 분류를 위한 다양한 분석 프롬프트들
 */

// ============================================================================
// 텍스트 기반 분석 프롬프트
// ============================================================================

const TEXT_BASED_ANALYSIS_PROMPT = `다음은 Google Vision API로 분석된 텍스트 결과입니다:

{textAnalysisResults}

위 텍스트 분석 결과를 바탕으로 쓰레기 분류를 수행해주세요.

**분석 요구사항:**
1. 텍스트에서 재활용 마크나 재질 정보를 찾아 분류
2. 파츠별로 재질이 다르게 표시된 경우 각각 분석
3. 한국의 실제 분리수거 기준에 맞춰 분류
4. 구체적이고 실용적인 분리수거 방법 제시

**응답 형식 (JSON):**
{
  "wasteType": "주요 쓰레기 타입 (예: 플라스틱, 종이, 유리, 캔류, 기타)",
  "subType": "세부 분류 (예: PET, HDPE, PP, 알루미늄, 스테인리스)",
  "recyclingMark": "재활용 마크 정보 (예: PET, HDPE, PP, 기타)",
  "description": "상세 설명",
  "disposalMethod": "분리수거 방법 (예: 재활용품, 일반쓰레기, 특수폐기물)",
  "confidence": 0.9,
  "materialParts": [
    {
      "part": "부분명 (예: 본체, 뚜껑, 라벨)",
      "material": "재질 (예: PET, PP, 알루미늄)",
      "description": "설명",
      "disposalMethod": "해당 부분의 분리수거 방법"
    }
  ]
}`;

// ============================================================================
// 통합 분석 프롬프트 (Vision API + GPT)
// ============================================================================

const UNIFIED_ANALYSIS_PROMPT = `다음은 Google Vision API로 분석된 결과입니다:

**탐지된 객체들:**
{objects}

**탐지된 라벨들:**
{labels}

**탐지된 텍스트들:**
{texts}

**재활용 마크/아이콘:**
{recyclingMarks}

위 정보를 종합하여 사용자가 찍은 쓰레기가 무엇인지 분석하고, 적절한 분리수거 방법을 제시해주세요.

**분석 기준:**
1. 객체 인식 결과로 물체의 기본 형태와 용도 파악
2. 라벨 인식 결과로 물체의 카테고리와 특성 파악
3. 텍스트 분석으로 재활용 마크나 아이콘 확인
4. 재활용 마크가 있으면 해당 마크를 우선적으로 고려
5. 한국의 실제 분리수거 기준에 맞춰 분류

**응답 형식 (JSON):**
{
  "wasteType": "주요 쓰레기 타입 (예: 플라스틱, 종이, 유리, 캔류, 기타)",
  "subType": "세부 분류 (예: PET, HDPE, PP, 알루미늄, 스테인리스)",
  "recyclingMark": "재활용 마크 정보 (예: PET, HDPE, PP, 기타)",
  "description": "상세 설명 (객체, 라벨, 텍스트 정보를 종합한 설명)",
  "disposalMethod": "분리수거 방법 (예: 재활용품, 일반쓰레기, 특수폐기물)",
  "confidence": 0.9,
  "analysisDetails": {
    "detectedObjects": "탐지된 주요 객체들",
    "detectedLabels": "탐지된 주요 라벨들",
    "detectedTexts": "탐지된 주요 텍스트들",
    "recyclingMarks": "탐지된 재활용 마크들"
  },
  "materialParts": [
    {
      "part": "부분명 (예: 본체, 뚜껑, 라벨)",
      "material": "재질 (예: PET, PP, 알루미늄)",
      "description": "설명",
      "disposalMethod": "해당 부분의 분리수거 방법"
    }
  ]
}`;

// ============================================================================
// 직접 이미지 분석 프롬프트
// ============================================================================

const DIRECT_IMAGE_ANALYSIS_PROMPT = `이 이미지를 보고 쓰레기 분류를 수행해주세요.

**분석 기준:**
1. 이미지에서 보이는 물체의 재질을 판단
2. 재활용 마크나 라벨이 있는지 확인
3. 물체의 형태와 용도를 고려
4. 한국의 실제 분리수거 기준에 맞춰 분류

**주의사항:**
- 재활용 마크가 명확히 보이지 않으면 일반쓰레기로 분류
- 여러 재질이 섞여있다면 주요 재질을 기준으로 분류
- 특수한 물체는 기타로 분류

**응답 형식 (JSON):**
{
  "wasteType": "주요 쓰레기 타입",
  "subType": "세부 분류",
  "recyclingMark": "재활용 마크 정보 (없으면 '해당없음')",
  "description": "이미지에서 보이는 물체에 대한 상세 설명",
  "disposalMethod": "분리수거 방법",
  "confidence": 0.8,
  "materialParts": [
    {
      "part": "본체",
      "material": "주요 재질",
      "description": "이미지에서 확인된 주요 재질",
      "disposalMethod": "일반쓰레기"
    }
  ]
}`;

// ============================================================================
// 객체 기반 분석 프롬프트
// ============================================================================

const OBJECT_BASED_ANALYSIS_PROMPT = `다음은 Google Vision API로 탐지된 객체들입니다:

**탐지된 객체들:**
{objectAnalysisResults}

**객체별 신뢰도:**
{objectConfidenceResults}

위 객체 인식 결과를 바탕으로 쓰레기 분류를 수행해주세요.

**분석 기준:**
1. 탐지된 객체의 재질을 추정
2. 객체의 용도와 형태를 고려
3. 재활용 가능한 물체인지 판단
4. 한국의 분리수거 기준에 맞춰 분류

**응답 형식 (JSON):**
{
  "wasteType": "주요 쓰레기 타입",
  "subType": "세부 분류",
  "recyclingMark": "재활용 마크 정보",
  "description": "탐지된 객체들에 대한 설명",
  "disposalMethod": "분리수거 방법",
  "confidence": 0.85,
  "materialParts": [
    {
      "part": "탐지된 객체",
      "material": "추정된 재질",
      "description": "객체 인식 결과 기반 설명",
      "disposalMethod": "분리수거 방법"
    }
  ]
}`;

// ============================================================================
// 라벨 기반 분석 프롬프트
// ============================================================================

const LABEL_BASED_ANALYSIS_PROMPT = `다음은 Google Vision API로 탐지된 라벨들입니다:

**탐지된 라벨들:**
{labelAnalysisResults}

**라벨별 신뢰도:**
{labelConfidenceResults}

위 라벨 인식 결과를 바탕으로 쓰레기 분류를 수행해주세요.

**분석 기준:**
1. 라벨에서 재질 정보를 찾아 분류
2. 라벨의 내용을 해석하여 분리수거 방법 결정
3. 한국의 분리수거 기준에 맞춰 분류
4. 라벨이 명확하지 않으면 일반쓰레기로 분류

**응답 형식 (JSON):**
{
  "wasteType": "주요 쓰레기 타입",
  "subType": "세부 분류",
  "recyclingMark": "재활용 마크 정보",
  "description": "탐지된 라벨들에 대한 설명",
  "disposalMethod": "분리수거 방법",
  "confidence": 0.8,
  "materialParts": [
    {
      "part": "라벨이 붙은 부분",
      "material": "라벨에서 확인된 재질",
      "description": "라벨 인식 결과 기반 설명",
      "disposalMethod": "분리수거 방법"
    }
  ]
}`;



// ============================================================================
// 2단계 분석 프롬프트들
// ============================================================================

/**
 * 1단계: 객체/라벨 인식으로 기본 타입 결정
 */
const BASIC_TYPE_ANALYSIS_PROMPT = `다음은 Google Vision API로 탐지된 객체와 라벨 정보입니다:

**탐지된 객체들:**
{objects}

**탐지된 라벨들:**
{labels}

위 정보를 바탕으로 쓰레기의 기본 타입과 분리수거 방법을 결정해주세요.

**분석 기준:**
1. 객체 인식 결과로 물체의 기본 형태와 용도 파악
2. 라벨 인식 결과로 물체의 카테고리와 특성 파악
3. 한국의 실제 분리수거 기준에 맞춰 분류
4. 재활용 가능한 물체인지 판단
5. **중요**: "Drink can", "Aluminum can", "Steel and tin cans" 등의 라벨이 있으면 "캔류"로 분류
6. **중요**: "Bottle", "Container" 등의 객체가 있으면 "플라스틱" 또는 "유리"로 분류

**중요: 반드시 완전한 JSON 형식으로 응답해주세요. 배열이나 객체가 중간에 끊어지지 않도록 주의하세요.**

**응답 형식 (JSON):**
\`\`\`json
{
  "wasteType": "주요 쓰레기 타입 (예: 플라스틱, 종이, 유리, 캔류, 기타)",
  "subType": "객체의 구체적인 종류 (예: 음료수병, 우유팩, 종이컵, 알루미늄캔, 유리병)",
  "description": "객체와 라벨 정보를 종합한 설명",
  "disposalMethod": "분리수거 방법 (예: 재활용품, 일반쓰레기, 특수폐기물)",
  "confidence": 0.9,
  "analysisDetails": {
    "detectedObjects": "탐지된 주요 객체들",
    "detectedLabels": "탐지된 주요 라벨들"
  }
}
\`\`\``;

/**
 * 2단계: 텍스트 분석으로 재활용 마크와 materialParts 결정
 */
const TEXT_BASED_MATERIAL_PROMPT = `다음은 Google Vision API로 탐지된 텍스트와 재활용 마크 정보입니다:

**탐지된 텍스트들:**
{texts}

**재활용 마크/아이콘:**
{recyclingMarks}

**1단계에서 결정된 기본 타입:**
- 타입: {basicType}
- 세부 분류: {basicSubType}

위 텍스트 정보를 바탕으로 재활용 마크를 확인하고, materialParts를 상세히 분석해주세요.

**분석 기준:**
1. 텍스트에서 재활용 마크나 아이콘 확인
2. 재활용 마크가 있으면 해당 마크를 우선적으로 고려
3. 텍스트에서 재질 정보를 찾아 materialParts 구성
4. 파츠별로 재질이 다르게 표시된 경우 각각 분석
5. 한국의 실제 분리수거 기준에 맞춰 분류
6. **중요**: 텍스트에서 명확한 재질 정보(PET, PP, HDPE, 알루미늄 등)가 없으면, 1단계에서 결정된 객체 타입({basicSubType})을 사용

**중요: 반드시 완전한 JSON 형식으로 응답해주세요. 배열이나 객체가 중간에 끊어지지 않도록 주의하세요.**

**응답 형식 (JSON):**
\`\`\`json
{
  "recyclingMark": "재활용 마크 정보 (예: PET, HDPE, PP, 기타)",
  "analysisDetails": {
    "detectedTexts": "탐지된 주요 텍스트들",
    "recyclingMarks": "탐지된 재활용 마크들"
  },
  "materialParts": [
    {
      "part": "부분명 (예: 본체, 뚜껑, 라벨)",
      "material": "재질 또는 객체 타입 (예: PET, PP, 알루미늄 또는 음료수병, 우유팩, 종이컵)",
      "description": "텍스트에서 확인된 재질 정보 또는 객체 설명",
      "disposalMethod": "해당 부분의 분리수거 방법"
    }
  ]
}
\`\`\``;

// ============================================================================
// 모듈 내보내기
// ============================================================================

module.exports = {
    TEXT_BASED_ANALYSIS_PROMPT,
    UNIFIED_ANALYSIS_PROMPT,
    DIRECT_IMAGE_ANALYSIS_PROMPT,
    OBJECT_BASED_ANALYSIS_PROMPT,
    LABEL_BASED_ANALYSIS_PROMPT,
    BASIC_TYPE_ANALYSIS_PROMPT,
    TEXT_BASED_MATERIAL_PROMPT
}; 