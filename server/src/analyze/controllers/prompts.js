/**
 * 쓰레기 분류를 위한 통합 분석 프롬프트
 */
const UNIFIED_SINGLE_STAGE_PROMPT = `이미지와 Google Vision API 분석 결과를 종합하여 쓰레기 분류를 수행해주세요. 응답은 반드시 JSON 형식으로 해주세요.

**Vision API 분석 결과:**
- 탐지된 라벨들: {labels}
- 탐지된 텍스트들: {texts}
- 재활용 마크/아이콘: {recyclingMarks}

**이미지에서 직접 확인할 수 있는 정보:**
- 물체의 형태와 크기
- 재활용 마크나 라벨의 위치
- 색상과 재질의 특성
- 부위별 재질 차이 (본체, 뚜껑, 라벨 등)

**분석 기준:**

**1단계: 이미지 기반 기본 분류**
- 이미지에서 물체의 형태, 색상, 재질을 직접 확인
- Vision API 라벨 결과와 이미지에서 보이는 물체가 일치하는지 검증
- "Drink can", "Aluminum can", "Steel and tin cans" 등의 라벨이 있으면 "캔류"로 분류
- "Bottle", "Container" 등의 라벨이 있으면 "플라스틱" 또는 "유리"로 분류
- "Paper", "Cardboard", "Box" 등의 라벨이 있으면 "종이"로 분류
- "Glass" 등의 라벨이 있으면 "유리"로 분류
- "Plastic" 등의 라벨이 있으면 "플라스틱"으로 분류
- 이미지에서 확인되는 재활용 마크나 라벨을 우선적으로 고려

**2단계: 이미지와 텍스트 기반 재활용 마크 분석**
- 이미지에서 직접 재활용 마크(PET, HDPE, PP, PS, PVC, LDPE 등) 확인
- 텍스트에서 재활용 마크 정보 확인
- 이미지와 텍스트에서 재질 정보(알루미늄, 스테인리스, 철, 구리 등) 확인
- 재활용 마크와 재질 정보가 일치하는지 검증
- **중요**: 이미지에서 "본체", "뚜껑", "라벨" 등의 부위별 재질 차이 확인
- **중요**: 이미지에서 재활용 마크가 없거나 라벨 이름이 명확하지 않으면 이미지로 어떤 물건인지 추측
- **중요**: wasteType과 subType이 재질적으로 다르면 subType을 우선적으로 따름
  - 예: wasteType "플라스틱" vs subType "비닐류" → "비닐류" 선택
  - 예: wasteType "기타" vs subType "PET" → "PET" 선택

**3단계: 이미지 기반 materialParts 상세 분석**
- 이미지에서 본체, 뚜껑, 라벨 등 부위별 재질 차이를 직접 확인
- 파츠별로 재질이 다르게 표시된 경우 각각 분석
- 텍스트와 이미지에서 확인된 재질 정보를 종합하여 부위별 분리수거 방법 결정
- **중요**: 재활용 마크에서 여러 재질이 감지된 경우 (예: "HDPE, PP"), 반드시 각각을 다른 부위로 분류
  - 첫 번째 재질(HDPE) → "본체"
  - 두 번째 재질(PP) → "뚜껑"
  - 세 번째 재질이 있다면 → "라벨" 또는 "기타"
- **중요**: 재활용 마크에 쉼표(,)가 있으면 반드시 각 재질을 별도의 materialParts 항목으로 만들어야 합니다.
- **중요**: 재활용 마크가 하나의 재질만 있는 경우(예: "LDPE", "PET")에는 본체만 분류하고 중복 분류하지 마세요.
- **중요**: 이미지에서 "본체-HDPE, 뚜껑-PP"처럼 명확한 부위-재질 매칭이 보이면 그대로 사용
- **중요**: 이미지에서 부위 정보가 없고 재질만 보이는 경우, 순서대로 "본체", "뚜껑", "라벨" 등으로 분류
- **중요**: 재활용 마크가 하나만 있는 경우에도 본체와 뚜껑이 다를 수 있으므로 확인

**4단계: 이미지 기반 최종 분류 결정**
- **중요**: 재활용 마크가 있으면 재활용 마크를 우선적으로 고려하여 최종 분류 결정
  - LDPE, HDPE, PP, PS, PVC → "플라스틱"
  - PET → "플라스틱" (PET)
  - 알루미늄, 스테인리스 → "캔류"
  - 종이, 카드보드 → "종이"
  - 유리 → "유리"
- 재활용 마크가 없으면 라벨과 이미지 기반 분류 결과 사용
- 한국의 실제 분리수거 기준에 맞춰 최종 결정
- 신뢰도는 이미지 분석 결과, 라벨 신뢰도, 텍스트 분석 결과를 종합하여 계산

**중요: 반드시 완전한 JSON 형식으로 응답해주세요. 배열이나 객체가 중간에 끊어지지 않도록 주의하세요.**
**중요: 재활용 마크가 있으면 라벨보다 재활용 마크를 우선적으로 고려하여 wasteType을 결정하세요.**

**materialParts 작성 규칙 (반드시 지켜주세요):**
- 재활용 마크에 여러 재질이 있으면 반드시 각각을 다른 부위로 분류해야 합니다.
- 재활용 마크가 "HDPE, PP"인 경우:
  - 본체: HDPE (용기의 주요 부분)
  - 뚜껑: PP (뚜껑 부분)
- 재활용 마크가 "PET" 하나만인 경우:
  - 본체: PET (전체가 동일한 재질)
- 재활용 마크가 "알루미늄, 스테인리스"인 경우:
  - 본체: 알루미늄 (캔의 본체)
  - 뚜껑: 스테인리스 (뚜껑 부분)
- **중요**: 재활용 마크에 쉼표(,)가 있으면 반드시 각 재질을 별도의 materialParts 항목으로 만들어야 합니다.
- **중요**: 재활용 마크가 하나의 재질만 있는 경우(예: "LDPE", "PET")에는 본체만 분류하고 중복 분류하지 마세요.

**응답 형식 (JSON):**
\`\`\`json
{
  "wasteType": "주요 쓰레기 타입 (예: 플라스틱, 종이, 유리, 캔류, 혹은 물건명)",
  "subType": "세부 분류 (예: PET, HDPE, PP, 알루미늄, 스테인리스)",
  "recyclingMark": "재활용 마크 정보 (예: PET, HDPE, PP, 기타)",
  "description": "라벨과 텍스트 정보를 종합한 상세 설명 (분석 과정 포함)",
  "disposalMethod": "분리수거 방법 (예: 투명페트병, 유색페트병(일반플라스틱), 일반쓰레기, 특수폐기물, 유리, 캔류, 종이, 비닐류)",
  "confidence": 0.9,
  "analysisDetails": {
    "detectedLabels": "탐지된 주요 라벨들",
    "detectedTexts": "탐지된 주요 텍스트들",
    "recyclingMarks": "탐지된 재활용 마크들",
    "analysisProcess": "분석 과정 설명 (1단계~4단계)"
  },
  "materialParts": [
    {
      "part": "부분명 (예: 본체, 뚜껑, 라벨, 기타, 파츠)",
      "material": "재질 (예: PET, PP, HDPE, 알루미늄, 스테인리스)",
      "description": "이미지와 텍스트에서 확인된 재질 정보 설명",
      "disposalMethod": "(응답 예: 투명페트병, 유색페트병(일반플라스틱), 일반쓰레기, 특수폐기물, 유리, 캔류, 종이, 비닐류 ~로 처리)"
    }
  ]
}
\`\`\`

**주의사항:**
- JSON 형식만 응답하고 다른 설명은 포함하지 마세요
- 모든 문자열은 큰따옴표로 감싸주세요
- 숫자는 따옴표 없이 그대로 작성해주세요
- 배열이나 객체가 중간에 끊어지지 않도록 주의해주세요
- 분석 과정을 description에 포함하여 정확성을 높이세요`;

// ============================================================================
// 모듈 내보내기
// ============================================================================

module.exports = {
    UNIFIED_SINGLE_STAGE_PROMPT
}; 